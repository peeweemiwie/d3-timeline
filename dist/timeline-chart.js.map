{"version":3,"sources":["timeline-chart.js"],"names":["TimelineChart","element","data","opts","self","classList","add","options","extendOptions","allElements","reduce","agg","e","concat","minDt","d3","min","getPointMinDt","maxDt","max","getPointMaxDt","elementWidth","width","clientWidth","elementHeight","height","clientHeight","margin","top","right","bottom","left","groupWidth","hideGroupLabels","x","time","scale","domain","range","xAxis","svg","axis","orient","tickSize","zoom","behavior","on","zoomed","select","append","attr","call","enableLiveTimer","now","groupHeight","length","groupSection","selectAll","enter","d","i","groupLabels","text","label","lineSection","groupIntervalItems","filter","_","type","TYPE","INTERVAL","intervalBarHeight","intervalBarMargin","intervals","withCustom","Math","intervalMinWidth","to","from","intervalTexts","groupDotItems","POINT","dots","at","tip","html","show","hide","console","error","setInterval","updateNowMarker","timerTickInterval","nowX","Date","defaultClass","customClass","join","onVizChangeFn","event","translate","positionData","getTextPositionData","upToPosition","textWidth","xPosition","percent","textTruncateThreshold","substr","floor","textSizeInPx","getComputedTextLength","ext","defaultOptions","undefined","Object","keys","map","k","p","fn","Symbol","module","exports"],"mappings":"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","file":"timeline-chart.js","sourcesContent":["class TimelineChart {\n  constructor(element, data, opts) {\n    let self = this;\n\n    element.classList.add('timeline-chart');\n\n    let options = this.extendOptions(opts);\n\n    let allElements = data.reduce((agg, e) => agg.concat(e.data), []);\n\n    let minDt = d3.min(allElements, this.getPointMinDt);\n    let maxDt = d3.max(allElements, this.getPointMaxDt);\n\n    let elementWidth = options.width || element.clientWidth;\n    let elementHeight = options.height || element.clientHeight;\n\n    let margin = {\n      top: 0,\n      right: 0,\n      bottom: 20,\n      left: 0\n    };\n\n    let width = elementWidth - margin.left - margin.right;\n    let height = elementHeight + 240;\n    let groupWidth = (options.hideGroupLabels) ? 0 : 200;\n\n    let x = d3.time.scale()\n      .domain([minDt, maxDt])\n      .range([groupWidth, width]);\n\n    let xAxis = d3.svg.axis()\n      .scale(x)\n      .orient('bottom')\n      .tickSize(-height);\n\n    let zoom = d3.behavior.zoom()\n      .x(x)\n      .on('zoom', zoomed);\n\n    let svg = d3.select(element).append('svg')\n      .attr('width', width + margin.left + margin.right)\n      .attr('height', height + margin.top + margin.bottom)\n      .append('g')\n      .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')\n      .call(zoom);\n\n    svg.append('defs')\n      .append('clipPath')\n      .attr('id', 'chart-content')\n      .append('rect')\n      .attr('x', groupWidth)\n      .attr('y', 0)\n      .attr('height', height)\n      .attr('width', width - groupWidth)\n\n    svg.append('rect')\n      .attr('class', 'chart-bounds')\n      .attr('x', groupWidth)\n      .attr('y', 0)\n      .attr('height', height)\n      .attr('width', width - groupWidth)\n\n    svg.append('g')\n      .attr('class', 'x axis')\n      .attr('transform', 'translate(0,' + height + ')')\n      .call(xAxis);\n\n    if (options.enableLiveTimer) {\n      self.now = svg.append('line')\n        .attr('clip-path', 'url(#chart-content)')\n        .attr('class', 'vertical-marker now')\n        .attr(\"y1\", 0)\n        .attr(\"y2\", height);\n    }\n\n    let groupHeight = height / data.length;\n    let groupSection = svg.selectAll('.group-section')\n      .data(data)\n      .enter()\n      .append('line')\n      .attr('class', 'group-section')\n      .attr('x1', 0)\n      .attr('x2', width)\n      .attr('y1', (d, i) => {\n        return groupHeight * (i + 1);\n      })\n      .attr('y2', (d, i) => {\n        return groupHeight * (i + 1);\n      });\n\n    if (!options.hideGroupLabels) {\n      let groupLabels = svg.selectAll('.group-label')\n        .data(data)\n        .enter()\n        .append('text')\n        .attr('class', 'group-label')\n        .attr('x', 0)\n        .attr('y', (d, i) => {\n          return (groupHeight * i) + (groupHeight / 2) + 5.5;\n        })\n        .attr('dx', '0.5em')\n        .text(d => d.label);\n\n      let lineSection = svg.append('line').attr('x1', groupWidth).attr('x2', groupWidth).attr('y1', 0).attr('y2', height).attr('stroke', 'black');\n    }\n\n/* ******************************************************\n  interval       \n****************************************************** */\n\n    let groupIntervalItems = svg.selectAll('.group-interval-item')\n      .data(data)\n      .enter()\n      .append('g')\n      .attr('clip-path', 'url(#chart-content)')\n      .attr('class', 'item')\n      .attr('transform', (d, i) => `translate(0, ${groupHeight * i})`)\n      .selectAll('.dot')\n      .data(d => d.data.filter(_ => _.type === TimelineChart.TYPE.INTERVAL))\n      .enter();\n\n    let intervalBarHeight = 0.8 * groupHeight;\n    let intervalBarMargin = (groupHeight - intervalBarHeight) / 2;\n    let intervals = groupIntervalItems\n      .append('rect')\n      .attr('class', withCustom('interval'))\n      .attr('width', (d) => Math.max(options.intervalMinWidth, x(d.to) - x(d.from)))\n      .attr('height', intervalBarHeight)\n      .attr('y', intervalBarMargin)\n      .attr('x', (d) => x(d.from));\n\n    let intervalTexts = groupIntervalItems\n      .append('text')\n      .text(d => d.label)\n      .attr('class', withCustom('interval-text'))\n      .attr('y', (groupHeight / 2) + 5)\n      .attr('x', (d) => x(d.from));\n\n/* ******************************************************\n  dot       \n****************************************************** */\n\n    let groupDotItems = svg.selectAll('.group-dot-item')\n      .data(data)\n      .enter()\n      .append('g')\n      .attr('clip-path', 'url(#chart-content)')\n      .attr('class', 'item')\n      .attr('transform', (d, i) => `translate(0, ${groupHeight * i})`)\n      .selectAll('.dot')\n      .data(d => {\n        return d.data.filter(_ => _.type === TimelineChart.TYPE.POINT);\n      })\n      .enter();\n\n    let dots = groupDotItems\n      .append('circle')\n      .attr('class', withCustom('dot'))\n      .attr('cx', d => x(d.at))\n      .attr('cy', groupHeight / 2)\n      .attr('r', 5);\n\n    if (options.tip) {\n      if (d3.tip) {\n        let tip = d3.tip().attr('class', 'd3-tip').html(options.tip);\n        svg.call(tip);\n        dots.on('mouseover', tip.show).on('mouseout', tip.hide);\n      } else {\n        console.error('Please make sure you have d3.tip included as dependency (https://github.com/Caged/d3-tip)');\n      }\n    }\n\n    zoomed();\n\n    if (options.enableLiveTimer) {\n      setInterval(updateNowMarker, options.timerTickInterval);\n    }\n\n    function updateNowMarker() {\n      let nowX = x(new Date());\n\n      self.now.attr('x1', nowX).attr('x2', nowX);\n    }\n\n    function withCustom(defaultClass) {\n      return d => d.customClass ? [d.customClass, defaultClass].join(' ') : defaultClass\n    }\n\n    function zoomed() {\n      if (self.onVizChangeFn && d3.event) {\n        self.onVizChangeFn.call(self, {\n          scale: d3.event.scale,\n          translate: d3.event.translate,\n          domain: x.domain()\n        });\n      }\n\n      if (options.enableLiveTimer) {\n        updateNowMarker();\n      }\n\n      svg.select('.x.axis').call(xAxis);\n\n      svg.selectAll('circle.dot').attr('cx', d => x(d.at));\n      svg.selectAll('rect.interval').attr('x', d => x(d.from)).attr('width', d => Math.max(options.intervalMinWidth, x(d.to) - x(d.from)));\n      svg.selectAll('rect.badge').attr('cx', d => x(d.at)).attr('width', elementWidth);\n\n      svg.selectAll('.interval-text').attr('x', function (d) {\n        let positionData = getTextPositionData.call(this, d);\n        if ((positionData.upToPosition - groupWidth - 10) < positionData.textWidth) {\n          return positionData.upToPosition;\n        } else if (positionData.xPosition < groupWidth && positionData.upToPosition > groupWidth) {\n          return groupWidth;\n        }\n        return positionData.xPosition;\n      }).attr('text-anchor', function (d) {\n        let positionData = getTextPositionData.call(this, d);\n        if ((positionData.upToPosition - groupWidth - 10) < positionData.textWidth) {\n          return 'end';\n        }\n        return 'start';\n      })\n        .attr('dx', function (d) {\n          let positionData = getTextPositionData.call(this, d);\n          if ((positionData.upToPosition - groupWidth - 10) < positionData.textWidth) {\n            return '-0.5em';\n          }\n          return '0.5em';\n        }).text(function (d) {\n          var positionData = getTextPositionData.call(this, d);\n          var percent = (positionData.width - options.textTruncateThreshold) / positionData.textWidth;\n          if (percent < 1) {\n            if (positionData.width > options.textTruncateThreshold) {\n              return d.label.substr(0, Math.floor(d.label.length * percent)) + '...';\n            } else {\n              return '';\n            }\n          }\n\n          return d.label;\n        });\n\n      function getTextPositionData(d) {\n        this.textSizeInPx = this.textSizeInPx || this.getComputedTextLength();\n        var from = x(d.from);\n        var to = x(d.to);\n        return {\n          xPosition: from,\n          upToPosition: to,\n          width: to - from,\n          textWidth: this.textSizeInPx\n        }\n      }\n    }\n  }\n  extendOptions(ext = {}) {\n    let defaultOptions = {\n      intervalMinWidth: 8, // px\n      tip: undefined,\n      textTruncateThreshold: 30,\n      enableLiveTimer: false,\n      timerTickInterval: 1000,\n      hideGroupLabels: false\n    };\n    Object.keys(ext).map(k => defaultOptions[k] = ext[k]);\n    return defaultOptions;\n  }\n  getPointMinDt(p) {\n    return p.type === TimelineChart.TYPE.POINT ? p.at : p.from;\n  }\n  getPointMaxDt(p) {\n    return p.type === TimelineChart.TYPE.POINT ? p.at : p.to;\n  }\n  onVizChange(fn) {\n    this.onVizChangeFn = fn;\n    return this;\n  }\n}\n\nTimelineChart.TYPE = {\n  POINT: Symbol(),\n  INTERVAL: Symbol()\n};\n\nmodule.exports = TimelineChart;\n"]}